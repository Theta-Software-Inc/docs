---
title: 'Accounting Tools'
description: 'Double-entry ledger with register, T-accounts, journal entry workflow, and bank-import'
---

Note on sessions
- Each tool call runs in a per-session environment with its own files:
  - Ledger file: `<session>/ledger.dat` (auto-created with opening balances)
  - Trial balance output: `<session>/generated_trial_balance.txt`
  - Journal entry database: `<session>/ledger.db`
- Dates for filters use YYYY/MM/DD unless otherwise noted.

## Account Balance & Register

### `ledger_balance`
Get account balances with flexible filtering, grouping, and display options. Also writes the same output to generated_trial_balance.txt in the session directory.

<Accordion title="View Parameters & Response">

Parameters:
```json title="ledger_balance - Request"
{
  "query": "string (optional) - Regex to filter accounts (e.g., 'Assets', '^Expenses:Food')",
  "accounts": "array[string] (optional) - One or more account patterns; takes precedence over 'query'",
  "begin_date": "string (optional) - Start date (YYYY/MM/DD)",
  "end_date": "string (optional) - End date (YYYY/MM/DD)",
  "depth": "integer (optional) - Limit account depth displayed",
  "monthly": "boolean (optional) - Group by month",
  "weekly": "boolean (optional) - Group by week",
  "daily": "boolean (optional) - Group by day",
  "yearly": "boolean (optional) - Group by year",
  "flat": "boolean (optional) - Show full account names without indentation",
  "no_total": "boolean (optional) - Don't show the final total"
}
```

Response:
```json title="ledger_balance - Response"
{
  "result": "Raw Ledger 'balance' output as a formatted text report"
}
```

</Accordion>

---

### ledger_register
Show a transaction register with support for filters, grouping, and sorting.

<Accordion title="View Parameters & Response">

Parameters:
```json title="ledger_register - Request"
{
  "query": "string (optional) - Regex to filter transactions (e.g., 'Expenses:Food', 'payee:Amazon')",
  "begin_date": "string (optional) - Start date (YYYY/MM/DD)",
  "end_date": "string (optional) - End date (YYYY/MM/DD)",
  "monthly": "boolean (optional) - Group by month",
  "weekly": "boolean (optional) - Group by week",
  "daily": "boolean (optional) - Group by day",
  "yearly": "boolean (optional) - Group by year",
  "sort": "string (optional) - Sort key: 'date', 'amount', or 'payee'",
  "by_payee": "boolean (optional) - Group by payee (-P)",
  "current": "boolean (optional) - Show only transactions on or before today (-c)"
}
```

Response (contract):
```json title="ledger_register - Response (success)"
{
  "result": "string - Raw Ledger 'register' output as formatted text"
}
```

Response (error):
```json title="ledger_register - Response (error)"
{
  "error": "string - Error message from Ledger or the tool"
}
```

What the result contains
- One line per posting, typically with 4–5 columns separated by at least two spaces:
  - date: YYYY/MM/DD
  - description: free text
  - account: first token that contains a colon (e.g., Expenses:Food)
  - amount: posting amount for that account (e.g., -$45.12 or $49.00)
  - balance (optional): running total after the posting
- Example snippet:
```
2025/05/01  SaaS subscription          Expenses:Software           $49.00          $49.00
2025/05/01  SaaS subscription          Assets:Cash:Checking       -$49.00           $0.00
2025/05/03  Grocery Store              Expenses:Food:Groceries    -$45.12         -$45.12
2025/05/03  Grocery Store              Assets:Cash:Checking        $45.12           $0.00
```


## Account Management
 
</Accordion>

### `ledger_accounts`
List accounts defined in the ledger, with optional filtering.

<Accordion title="View Parameters & Response">

Parameters:
```json title="ledger_accounts - Request"
{
  "query": "string (optional) - Regex to filter account names"
}
```

Response:
```json title="ledger_accounts - Response"
{
  "result": "Text list of account names (one per line)"
}
```

</Accordion>


## Transaction Analysis

### `get_t_accounts`
Produce T-account views (debits on the left, credits on the right) for selected accounts and date ranges.

<Accordion title="View Parameters & Response">

Parameters:
```json title="get_t_accounts - Request"
{
  "accounts": "array[string] (optional) - Specific accounts to include (all accounts if omitted)",
  "begin_date": "string (optional) - Start date (YYYY/MM/DD)",
  "end_date": "string (optional) - End date (YYYY/MM/DD)"
}
```

Response:
```json title="get_t_accounts - Response"
{
  "result": "Formatted T-account text for each account with totals and balance (Dr/Cr)"
}
```

Example output snippet:
```
============================================================
                    Assets:Cash:Checking                    
============================================================
DEBIT                        │                        CREDIT
-----------------------------┼------------------------------
       1,250.00              │
-----------------------------┼------------------------------
Total:         1,250.00      │ Total:             0.00
============================================================
Balance: $1,250.00 Dr
```

</Accordion>


## Bank Import & Reconciliation

### `load_bank_transactions`
Load and normalize bank transactions from a CSV file for review and matching. Detects likely matches already present in the ledger.

<Accordion title="View Parameters & Response">

Parameters:
```json title="load_bank_transactions - Request"
{
  "file_path": "string (required) - Absolute path to CSV with headers: Date, Description, Amount (3-column) or Date, Description, Credit, Debit (4-column)",
  "account": "string (required) - GL account for these transactions (e.g., 'Assets:Cash:Mercury')"
}
```

Response:
```json title="load_bank_transactions - Response (top-level)"
{
  "result": "JSON string (parse it to access fields below)"
}
```

Parsed JSON structure:
```json title="load_bank_transactions - Parsed Result"
{
  "transaction_count": 123,
  "transactions": [
    {
      "transaction_id": "sha1-hash",
      "date": "2024/03/12",
      "description": "CARD PURCHASE WHOLE FOODS",
      "amount": -54.28,
      "account": "Assets:Cash:Mercury",
      "status": "matched | unmatched"
    }
  ]
}
```

Notes:
- Supported date formats in CSV: YYYY-MM-DD, YYYY/MM/DD, MM/DD/YYYY, DD/MM/YYYY.
- CSV header options: "Date, Description, Amount" (3 columns) or "Date, Description, Credit, Debit" (4 columns). If Credit/Debit are present, they are normalized to a single numeric amount.
- Amounts are parsed as numbers; currency symbols and commas are stripped.
- On errors, the result is a JSON string like: `{"error": "message here"}`.

</Accordion>


## Journal Entry Workflow

### `create_journal_entry`
Create a draft journal entry in the session database for review. Entries must balance (total debits = total credits).

<Accordion title="View Parameters & Response">

Parameters:
```json title="create_journal_entry - Request"
{
  "date": "string (required) - YYYY/MM/DD or YYYY-MM-DD",
  "description": "string (required) - Detailed description",
  "lines": [
    {
      "account": "string (required) - e.g., 'Expenses:Food'",
      "debit": "number (optional, default 0)",
      "credit": "number (optional, default 0)"
    }
  ],
  "justification": "string (optional) - Business reason",
  "source_ids": "array[string] (optional) - IDs from bank imports to link"
}
```

Response:
```json title="create_journal_entry - Response (top-level)"
{
  "result": "JSON string (parse for details)"
}
```

Parsed JSON structure:
```json title="create_journal_entry - Parsed Result"
{
  "entry_id": "JE-uuid-or-hash",
  "status": "draft",
  "message": "Draft journal entry ... created successfully. Use post_journal_entry to make it permanent."
}
```

Errors are returned as:
```json
{"error": "Why it failed"}
```

</Accordion>

---

### `get_journal_entries`
Query journal entries (draft or posted) with multiple filters.

<Accordion title="View Parameters & Response">

Parameters:
```json title="get_journal_entries - Request"
{
  "entry_ids": "array[string] (optional) - Fetch specific IDs",
  "status": "string (optional, default 'all') - 'draft' | 'posted' | 'all'",
  "begin_date": "string (optional) - YYYY/MM/DD",
  "end_date": "string (optional) - YYYY/MM/DD",
  "account": "string (optional) - Return entries that include this account",
  "source_id": "string (optional) - Entries linked to a specific bank transaction"
}
```

Response:
```json title="get_journal_entries - Response (top-level)"
{
  "result": "JSON string (pretty-printed array)"
}
```

Parsed JSON structure:
```json title="get_journal_entries - Parsed Result"
[
  {
    "entry_id": "JE-123",
    "date": "2024/04/01",
    "description": "April rent",
    "status": "draft | posted",
    "lines": [
      {"account": "Expenses:Rent", "debit": 2000, "credit": 0},
      {"account": "Assets:Cash:Checking", "debit": 0, "credit": 2000}
    ],
    "created_at": "2024-04-01T12:34:56.789000",
    "posted_at": "2024-04-01T12:45:00.000000",
    "modified_at": "2024-04-01T12:44:59.000000",
    "source_ids": ["<optional-import-id>"]
  }
]
```

Errors are returned as:
```json
{"error": "Failed to retrieve journal entries: message"}
```

</Accordion>

---

### `post_journal_entry`
Post a draft entry to make it permanent. This dual-writes: marks it posted in the database and appends the formatted entry to the session’s ledger.dat. The ledger file is validated after write.

<Accordion title="View Parameters & Response">

Parameters:
```json title="post_journal_entry - Request"
{
  "entry_id": "string (required) - The draft entry to post"
}
```

Response:
```json title="post_journal_entry - Response (top-level)"
{
  "result": "JSON string (parse for details)"
}
```

Parsed JSON structure (success):
```json title="post_journal_entry - Parsed Result"
{
  "entry_id": "JE-123",
  "status": "posted",
  "posted_at": "2024-04-01T12:45:00.000000",
  "ledger_impact": {
    "...": "Implementation-specific details of amounts/accounts"
  },
  "message": "Journal entry JE-123 successfully posted to both database and ledger file"
}
```

If the ledger file write or validation has issues:
```json
{
  "entry_id": "JE-123",
  "status": "posted",
  "posted_at": "2024-04-01T12:45:00.000000",
  "ledger_impact": { },
  "warning": "Ledger file update failed: ...",
  "message": "Journal entry JE-123 posted to database only"
}
```

Errors are returned as:
```json
{"error": "Why posting failed"}
```

</Accordion>


## Usage Examples

### Common reporting
```python
# Account balances for top-level Assets, flat names, depth 2
balances = call_tool("ledger_balance", {
  "accounts": ["Assets"],
  "depth": 2,
  "flat": True
})

# Month-by-month expenses YTD
expenses_by_month = call_tool("ledger_balance", {
  "accounts": ["Expenses"],
  "begin_date": "2025/01/01",
  "end_date": "2025/12/31",
  "monthly": True
})

# Register for groceries last quarter, sorted by amount
grocery_register = call_tool("ledger_register", {
  "query": "Expenses:Food:Groceries",
  "begin_date": "2025/04/01",
  "end_date": "2025/06/30",
  "sort": "amount"
})
```

### T-account analysis
```python
t_accounts = call_tool("get_t_accounts", {
  "accounts": ["Assets:Cash:Checking", "Expenses:Rent"],
  "begin_date": "2025/01/01",
  "end_date": "2025/03/31"
})
```

### Bank import and reconciliation
```python
# Import CSV (must be absolute path) and normalize
import_result = call_tool("load_bank_transactions", {
  "file_path": "/absolute/path/to/mercury_may.csv",
  "account": "Assets:Cash:Mercury"
})
# Parse JSON string result if needed:
# data = json.loads(import_result["result"])
```

### Journal entries: draft, review, post
```python
# Create a draft JE for software subscription
draft = call_tool("create_journal_entry", {
  "date": "2025/05/01",
  "description": "SaaS subscription - May",
  "lines": [
    {"account": "Expenses:Software", "debit": 49.00, "credit": 0},
    {"account": "Assets:Cash:Checking", "debit": 0, "credit": 49.00}
  ],
  "justification": "Monthly subscription per contract"
})

# List draft entries for review
drafts = call_tool("get_journal_entries", {
  "status": "draft",
  "begin_date": "2025/05/01",
  "end_date": "2025/05/31"
})

# Post a specific draft by ID
posted = call_tool("post_journal_entry", {
  "entry_id": "JE-1234567890"
})
```

Practical tips
- Choose only one of monthly/weekly/daily/yearly for grouping.
- CSV import accepts dates: YYYY-MM-DD, YYYY/MM/DD, MM/DD/YYYY, or DD/MM/YYYY.
- Positive amounts in T-accounts are treated as debits; negative as credits.
- On first use in a session, a ledger.dat is created automatically with an opening balance entry dated 2024/01/01.